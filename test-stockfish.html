<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stockfish Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.loading { background: #f39c12; }
        .status.success { background: #27ae60; }
        .status.error { background: #e74c3c; }
        button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #357abd;
        }
    </style>
</head>
<body>
    <h1>Stockfish Engine Test</h1>
    
    <div class="test-section">
        <h2>Engine Status</h2>
        <div id="engine-status" class="status loading">Initializing Stockfish engine...</div>
    </div>
    
    <div class="test-section">
        <h2>Position Analysis</h2>
        <p>Test position: Starting position (1.e4)</p>
        <button id="test-analysis">Analyze Position</button>
        <div id="analysis-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test Results</h2>
        <div id="test-results"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chess.js@0.10.3/chess.js"></script>
    <script src="stockfish-web-worker.js"></script>
    <script>
        let stockfish = null;
        let testResults = [];

        function updateStatus(message, type) {
            const status = document.getElementById('engine-status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        function addTestResult(test, result, success) {
            testResults.push({ test, result, success });
            updateTestDisplay();
        }

        function updateTestDisplay() {
            const container = document.getElementById('test-results');
            container.innerHTML = testResults.map(test => 
                `<div class="status ${test.success ? 'success' : 'error'}">
                    <strong>${test.test}:</strong> ${test.result}
                </div>`
            ).join('');
        }

        async function initializeStockfish() {
            try {
                updateStatus('Loading Stockfish engine...', 'loading');
                stockfish = new StockfishEngine();
                
                await stockfish.waitForReady();
                updateStatus('Stockfish engine ready!', 'success');
                addTestResult('Engine Initialization', 'Success - Stockfish loaded', true);
                
                // Enable the test button
                document.getElementById('test-analysis').disabled = false;
                
            } catch (error) {
                updateStatus('Stockfish failed to load, using fallback', 'error');
                addTestResult('Engine Initialization', `Failed: ${error.message}`, false);
                
                // Still enable test button for fallback testing
                document.getElementById('test-analysis').disabled = false;
            }
        }

        async function testAnalysis() {
            const button = document.getElementById('test-analysis');
            const resultDiv = document.getElementById('analysis-result');
            
            button.disabled = true;
            button.textContent = 'Analyzing...';
            resultDiv.innerHTML = '<div class="status loading">Analyzing position...</div>';
            
            try {
                // Test position: 1.e4 (King's pawn opening)
                const chess = new Chess();
                chess.move('e4');
                const fen = chess.fen();
                
                console.log('Testing position:', fen);
                
                const startTime = Date.now();
                const result = await stockfish.evaluate(fen, 12);
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                resultDiv.innerHTML = `
                    <div class="status success">
                        <strong>Analysis Complete!</strong><br>
                        Evaluation: ${result.evaluation > 0 ? '+' : ''}${result.evaluation.toFixed(2)}<br>
                        Best Move: ${result.bestMove || 'N/A'}<br>
                        Depth: ${result.depth}<br>
                        Time: ${duration}ms
                    </div>
                `;
                
                addTestResult('Position Analysis', 
                    `Success - Eval: ${result.evaluation.toFixed(2)}, Time: ${duration}ms`, true);
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="status error">Analysis failed: ${error.message}</div>`;
                addTestResult('Position Analysis', `Failed: ${error.message}`, false);
            } finally {
                button.disabled = false;
                button.textContent = 'Analyze Position';
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            initializeStockfish();
            document.getElementById('test-analysis').addEventListener('click', testAnalysis);
        });
    </script>
</body>
</html>
